# GLBファイル処理完成の要件

## 概要
rp_handler.pyを完成させ、外部APIから取得した3DモデルのGLBファイル本体とテクスチャをRunPodサーバーレス環境で返却できるようにする。

## 機能要件

### 1. GLBファイル本体の返却
- 外部API（Synexa/HunyuAn3D）から取得したGLBファイルのURLをそのまま返却する
- テクスチャ抽出のためGLBファイルをダウンロードするが、処理後は元のURLを返却する
- GLBファイル本体をBase64エンコードして返却することは避け、通信量を削減する
- 既に存在する`textured_glb_file_url`を活用する

### 2. テクスチャファイルの返却
- GLBファイルから抽出したテクスチャ（PNG形式）をBase64エンコード形式で返却する
- 複数のテクスチャファイルが存在する場合は、すべてをリスト形式で返却する
- 各テクスチャのファイル名も併せて返却する

### 3. エラーハンドリング
- 外部APIへのリクエストが失敗した場合、適切なエラーメッセージを返却する
- GLBファイルのダウンロードに失敗した場合、エラーメッセージを返却する
- テクスチャの抽出に失敗した場合、エラーメッセージを返却する

### 4. 返却形式

#### 成功時の返却形式：
```json
{
    "glb_url": "https://example.com/path/to/textured_mesh.glb",
    "textures": [
        {
            "data": "Base64エンコードされたテクスチャデータ",
            "filename": "texture_0.png"
        },
        {
            "data": "Base64エンコードされたテクスチャデータ",
            "filename": "texture_1.png"
        }
    ]
}
```

#### エラー時の返却形式（RunPod推奨）：
```json
{
    "error": "エラーメッセージ"
}
```

**設計方針**: 
- GLBファイルはテクスチャ抽出のため一度ダウンロードするが、返却時は元のURLを使用
- GLBファイル本体（数十MB〜100MB）のBase64エンコードを避けることで通信量を大幅削減
- テクスチャは通常サイズが小さいため（数MB程度）、Base64エンコードで直接返却
- この方式により、大きなGLBファイルの返却時の転送を避けつつ、必要なテクスチャデータは即座に利用可能

## 非機能要件

### 1. パフォーマンス
- 大きなGLBファイル（〜100MB）のダウンロードは必要最小限に抑える
- テクスチャのBase64エンコード処理はメモリ効率を考慮すること
- 通信量を最小化することでレスポンスタイムを改善

### 2. 保守性
- コードは可読性を重視し、適切なコメントを付与する
- 既存のutils関数を最大限活用する

### 3. 互換性
- RunPodのサーバーレス環境で動作すること
- 既存のutils/glb_utils.pyの関数との互換性を保つこと

## テスト要件

### 1. 単体テスト
- GLBファイルの読み込みとBase64エンコードが正しく動作することを確認
- テクスチャファイルの読み込みとBase64エンコードが正しく動作することを確認
- エラーハンドリングが適切に動作することを確認

### 2. 統合テスト
- 実際の外部APIを使用した場合の動作確認
- モックデータを使用した場合の動作確認
- 返却されたデータが期待される形式になっていることを確認

### 3. エッジケース
- テクスチャが存在しないGLBファイルの場合
- 複数のテクスチャが存在する場合
- 非常に大きなファイルサイズの場合
- ネットワークエラーが発生した場合